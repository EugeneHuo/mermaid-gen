<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Mermaid Diagram</title>
</head>
<body>
    <div class="mermaid">

flowchart TD
  title["AIA Koodo Pipeline"]
  purpose["Purpose: Ingests and processes Koodo data for AI applications"]
  note["Owner: AIGT"]

  subgraph Step1_Ingestion
    A[" Source: Koodo database<br/> Type: Customer data"]
    B[" Fetching from: https://www.koodomobile.com/static/help/api/articles<br/> Tokens: en, fr"]
    A --> B
  end

  subgraph Step2_Chunking
    C[" Method: MarkdownHeaderTextSplitter<br/> Headers to split on: Config<br/> Strip Headers: Config"]
    D[" Method: RecursiveCharacterTextSplitter<br/> Size: 475 tokens, Overlap: 50<br/> Splits by: cl100k_base"]
    B --> C --> D
  end

  subgraph Step3_Embedding
    E[" Model: Config[embedding_model_name]<br/> Service: OpenAI API<br/> API Key: Config[litellm-proxy-key-aia-koodo]"]
    F[" Cache: pickle file from GCS<br/> File: Config[PICKLE_FILE]<br/>"]
    D --> E --> F
  end

  subgraph Step4_Storing
    G[" Service: Turbopuffer<br/> Namespace: Config[INDEX_NAME]<br/> Alias: Config[ALIAS_NAME]"]
    H[" Firestore Collection: Config[turbopuffer-client-id-firestore-collection]<br/> Document: Namespace name"]
    F --> G --> H
  end

  subgraph Step5_Logging
    I[" Log collection<br/> Project ID: Config[PROJECT_ID]<br/> Log Table ID: Config[LOG_TABLE_ID]"]
    C --> I
    E --> I
    G --> I
  end

  title -.-> purpose
  title -.-> note

    </div>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>
</body>
</html>
